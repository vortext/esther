!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JSONRepair={})}(this,function(t){"use strict";class A extends Error{constructor(t,e){super(t+" at position "+e),this.position=e}}const e=32,g=10,v=9,b=13,p=8,w=12,x=34,r=39,y=48,O=49,N=57,n=65,o=97,c=70,i=102,J=160,S=8192,j=8202,I=8239,k=8287,m=12288,f=8220,a=8221,u=8216,d=8217,h=96,l=180;function T(t){return t>=y&&t<=N||t>=n&&t<=c||t>=o&&t<=i}function $(t){return t>=y&&t<=N}const G=/^[,:[\]{}()\n]$/;function E(t){return s.test(t)||t&&U(t.charCodeAt(0))}const s=/^[[{\w-]$/;function R(t){return t===e||t===g||t===v||t===b}function U(t){return F(t)||z(t)}function F(t){return t===x||t===f||t===a}function q(t){return t===x}function z(t){return t===r||t===u||t===d||t===h||t===l}function B(t,e,r){r=2<arguments.length&&void 0!==r&&r,e=t.lastIndexOf(e);return-1!==e?t.substring(0,e)+(r?"":t.substring(e+1)):t}function D(t,e){let r=t.length;if(!R(t.charCodeAt(r-1)))return t+e;for(;R(t.charCodeAt(r-1));)r--;return t.substring(0,r)+e+t.substring(r)}const H={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},K={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};t.JSONRepairError=A,t.jsonrepair=function(i){let f=0,a="";if(!o())throw new A("Unexpected end of json string",i.length);var t=c(44);if(t&&u(),E(i[f])&&/[,\n][ \t\r]*$/.test(a)){t||(a=D(a,","));{let t=!0,e=!0;for(;e;)t?t=!1:c(44)||(a=D(a,",")),e=o();e||(a=B(a,","));a="[\n".concat(a,"\n]")}}else t&&(a=B(a,","));if(f>=i.length)return a;throw new A("Unexpected character "+JSON.stringify(i[f]),f);function o(){u();var t=function(){if(123!==i.charCodeAt(f))return!1;{a+="{",f++,u();let e=!0;for(;f<i.length&&125!==i.charCodeAt(f);){let t;if(e?(t=!0,e=!1):((t=c(44))||(a=D(a,",")),u()),!(h()||l())){125===i.charCodeAt(f)||123===i.charCodeAt(f)||93===i.charCodeAt(f)||91===i.charCodeAt(f)||void 0===i[f]?a=B(a,","):function(){throw new A("Object key expected",f)}();break}u();var r=c(58),n=(r||(E(i[f])?a=D(a,":"):C()),o());n||(r?a+="null":C())}return 125===i.charCodeAt(f)?(a+="}",f++):a=D(a,"}"),!0}}()||function(){if(91!==i.charCodeAt(f))return!1;{a+="[",f++,u();let t=!0;for(;f<i.length&&93!==i.charCodeAt(f);){t?t=!1:c(44)||(a=D(a,","));var e=o();if(!e){a=B(a,",");break}}return 93===i.charCodeAt(f)?(a+="]",f++):a=D(a,"]"),!0}}()||h()||function(){var t=f;if(45===i.charCodeAt(f)&&(f++,s(t)))return!0;if(i.charCodeAt(f)===y)f++;else if(function(t){return t>=O&&t<=N}(i.charCodeAt(f)))for(f++;$(i.charCodeAt(f));)f++;if(46===i.charCodeAt(f)){if(f++,s(t))return!0;for(;$(i.charCodeAt(f));)f++}if(101===i.charCodeAt(f)||69===i.charCodeAt(f)){if(f++,45!==i.charCodeAt(f)&&43!==i.charCodeAt(f)||f++,s(t))return!0;for(;$(i.charCodeAt(f));)f++}if(f>t)return a+=i.slice(t,f),!0;return!1}()||r("true","true")||r("false","false")||r("null","null")||r("True","true")||r("False","false")||r("None","null")||l();return u(),t}function u(){f;let t=e();for(;t=(t=function(){if(47===i.charCodeAt(f)&&42===i.charCodeAt(f+1)){for(;f<i.length&&!function(t,e){return"*"===t[e]&&"/"===t[e+1]}(i,f);)f++;f+=2}else{if(47!==i.charCodeAt(f)||47!==i.charCodeAt(f+1))return!1;for(;f<i.length&&i.charCodeAt(f)!==g;)f++}return!0}())&&e(););f}function e(){let t="";for(var e,r;(e=R(i.charCodeAt(f)))||(r=i.charCodeAt(f))===J||r>=S&&r<=j||r===I||r===k||r===m;)t+=e?i[f]:" ",f++;return 0<t.length&&(a+=t,!0)}function c(t){return i.charCodeAt(f)===t&&(a+=i[f],f++,!0)}function d(){92===i.charCodeAt(f)&&f++}function h(){let t=92===i.charCodeAt(f);if(t&&(f++,t=!0),U(i.charCodeAt(f))){var e=z(i.charCodeAt(f))?z:q(i.charCodeAt(f))?q:F;for(a+='"',f++;f<i.length&&!e(i.charCodeAt(f));){if(92===i.charCodeAt(f)){var r=i[f+1];if(void 0!==K[r])a+=i.slice(f,f+2),f+=2;else if("u"===r){if(!(T(i.charCodeAt(f+2))&&T(i.charCodeAt(f+3))&&T(i.charCodeAt(f+4))&&T(i.charCodeAt(f+5)))){n=void 0;var n=f;let t=n+2;for(;/\w/.test(i[t]);)t++;n=i.slice(n,t);throw new A('Invalid unicode character "'.concat(n,'"'),f)}a+=i.slice(f,f+6),f+=6}else a+=r,f+=2}else{n=i[f],r=i.charCodeAt(f);if(r===x&&92!==i.charCodeAt(f-1))a+="\\"+n;else if((c=r)===g||c===b||c===v||c===p||c===w)a+=H[n];else{if(!(32<=(c=r)&&c<=1114111))throw c=void 0,c=n,new A("Invalid character "+JSON.stringify(c),f);a+=n}f++}t&&d()}U(i.charCodeAt(f))?(i.charCodeAt(f),x,a+='"',f++):a+='"';{let t=!1;u();for(;43===i.charCodeAt(f);){t=!0,f++,u();var o=(a=B(a,'"',!0)).length;h(),a=function(t,e,r){return t.substring(0,e)+t.substring(e+r)}(a,o,1)}t}return!0}var c;return!1}function r(t,e){return i.slice(f,f+t.length)===t&&(a+=e,f+=t.length,!0)}function l(){for(var t,e=f;f<i.length&&(t=i[f],!(G.test(t)||t&&U(t.charCodeAt(0))));)f++;if(f>e){if(40===i.charCodeAt(f))f++,o(),41===i.charCodeAt(f)&&(f++,59===i.charCodeAt(f))&&f++;else{for(;R(i.charCodeAt(f-1))&&0<f;)f--;e=i.slice(e,f);a+="undefined"===e?"null":JSON.stringify(e)}return!0}}function n(t){if(!$(i.charCodeAt(f)))throw t=i.slice(t,f),new A("Invalid number '".concat(t,"', expecting a digit ").concat(i[f]?"but got '".concat(i[f],"'"):"but reached end of input"),2)}function s(t){if(f>=i.length)return a+=i.slice(t,f)+"0",1;n(t)}function C(){throw new A("Colon expected",f)}}});